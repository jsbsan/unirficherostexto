' Gambas class file

Public Sub Form_Open()

  Settings.Read(Me)
  ButtonLimpiar_Click()
  LabelVERSION.Text = "Version: " & Application.Version

End

Public Sub ButtonUNIR_Click()

  ButtonUNIR.Text = "espere....."
  Wait 0.1
  unirficheros
  Wait 0.1
  ButtonUNIR.Text = "Unir"

End

Public Sub Label1_MouseDown()

End

Public Sub Form_Close()

  Settings.Write(Me)

End

Public Sub unirficheros()

  Dim nombrefinal As String
  Dim nombres As String[]
  Dim n As String
  Dim contenido As String
  Dim horacreacion As String
  Dim rutaPorDefecto As String' para guardar los resultados de la union de ficheros
  Dim contador As Integer
  '  Dim nombrecompleto As String

  TextArea1.Text = Replace(TextArea1.text, "file://", "")
  TextArea1.Text = Replace(TextArea1.text, "\r", "")
  TextArea1.Text = Replace(TextArea1.text, "%20", " ")

  nombres = Split(TextArea1.text, "\n")
  contador = 0
  For Each n In nombres
    If Exist(n) Then
      contenido &= File.Load(n)
      ' nombrecompleto &= "_" & Replace(File.BaseName(n), "test_", "")
      contador += 1
    Endif

  Next

  horacreacion = Format(Now, "yyyy_mm_dd_hh_nn_ss")

  rutaPorDefecto = Settings["ruta", user.home & "/PDF"]

  nombrefinal = rutaPorDefecto & "/unido" & horacreacion & "_" & TextBoxSufijo.text & ".csv"

  File.Save(nombrefinal, contenido)
  Label3.Text = nombrefinal 'para que no de problemas con el nombre muy largo"
  Label3.Tooltip = nombrefinal
  LabelTotalUnidos.Text = " " & Str(contador) & " ficheros"
  ' Message.Info("terminado de unir ficheros" & "\n" & horacreacion)
  Music.Load("cartoon048.mp3")
  Music.Volume = 20
  Music.play
  ' Desktop.Open(rutaPorDefecto)

End

Public Sub ButtonConfiguracion_Click()

  Dialog.Path = Settings["ruta"]
  If Dialog.SelectDirectory() Then
  Else

    Settings["ruta"] = Dialog.Path
  Endif

End

Public Sub ButtonLimpiar_Click()

  TextArea1.Text = ""
  Label3.Text = ""
  Label3.Tooltip = ""
  TextBoxSufijo.Text = ""
  LabelTotalUnidos.Text = ""

End

Public Sub Label3_MouseDown()

End

Public Sub ButtonAbrir_Click()

  Dim rutaPorDefecto As String

  rutaPorDefecto = Settings["ruta", user.home & "/PDF"]
  Desktop.Open(rutaPorDefecto)

End

Public Sub ButtonbORRAR_Click()

  Dim n As String
  Dim nombres As String[]
  'borra los ficheros que ha unido...
  TextArea1.Text = Replace(TextArea1.text, "file://", "")
  TextArea1.Text = Replace(TextArea1.text, "\r", "")
  TextArea1.Text = Replace(TextArea1.text, "%20", " ")

  nombres = Split(TextArea1.text, "\n")

  For Each n In nombres
    If Exist(n) Then
      Kill n
    Endif

  Next
  TextArea1.Text = ""
  TextArea1.Refresh()

End

Public Sub ButtonCargaFicheros_Click()

  Dim f As String
  Dim rutaPorDefecto As String = Settings["ruta", user.home & "/PDF"]

  TextArea1.text = ""
  For Each f In Dir(rutaPorDefecto, "test_*.csv", gb.file).Sort()
    TextArea1.Text &= rutaPorDefecto & "/" & f & "\n"
  Next
  TextArea1.Refresh()

End
